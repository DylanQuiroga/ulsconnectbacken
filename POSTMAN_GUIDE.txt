ULSConnect Backend - Guía Postman

Este archivo contiene instrucciones para probar los endpoints del backend con Postman.

PASO 1: Importar la colección
1. Abre Postman (descárgalo desde https://www.postman.com/downloads/ si no lo tienes)
2. Ve a File → Import
3. Selecciona "ULSConnect.postman_collection.json"
4. Haz clic en "Import"

PASO 2: Asegurar que el servidor esté corriendo
Ejecuta en terminal:
  npm run dev

Deberías ver:
  [nodemon] starting `node app.js`
  Server running on port 3000
  Connected to MongoDB (o warning si no está configurado)

PASO 3: Probar los endpoints

FLUJO DE PRUEBA COMPLETO:
1) Health Check
   - GET http://localhost:3000/
   - Verifica que el servidor responda

2) Signup (Crear solicitud de registro)
   - POST http://localhost:3000/signup
   - Cuerpo (form-data):
     - correoUniversitario: estudiante@usena.cl
     - nombre: Juan Perez
     - contrasena: SecurePass123!
   - Respuesta esperada: Página de éxito "Solicitud de registro enviada"

3) Login (Iniciar sesión)
   - POST http://localhost:3000/login
   - Mismo correo y contraseña del paso 2
   - Respuesta esperada: Redirección a perfil
   - NOTA: Primero debe ser APROBADA la solicitud de registro (ver paso 4)

4) Get All Registration Requests (SOLO ADMIN/STAFF)
   - GET http://localhost:3000/registrations/requests
   - Requiere estar logueado como admin o staff
   - Respuesta: Lista de solicitudes pendientes
   - NOTA: Copia el ID de la solicitud creada en paso 2

5) Approve Registration Request
   - POST http://localhost:3000/registrations/requests/[REQUEST_ID]/approve
   - Reemplaza [REQUEST_ID] con el ID del paso 4
   - Cuerpo (JSON):
     {
       "notes": "Aprobado - Bienvenido"
     }
   - Respuesta esperada: 200 OK

6) Login (Reintentar)
   - Ahora debería funcionar después de ser aprobado
   - GET http://localhost:3000/profile
   - Verifica que tu perfil sea devuelto

7) Get Activities
   - GET http://localhost:3000/activities
   - Obtiene todas las actividades
   - Si es vacío, crea una primero (paso 8)

8) Create Activity (SOLO ADMIN/STAFF)
   - POST http://localhost:3000/activities
   - Cuerpo (JSON):
     {
       "titulo": "Taller de Python",
       "descripcion": "Aprende Python",
       "area": "Tecnología",
       "tipo": "Taller",
       "fechaInicio": "2024-11-25T10:00:00Z",
       "fechaFin": "2024-11-25T14:00:00Z",
       "ubicacion": "Sala 101",
       "capacidad": 30
     }
   - Respuesta: Devuelve la actividad creada con su ID

9) Enroll in Activity
   - POST http://localhost:3000/activities/[ACTIVITY_ID]/enroll
   - Reemplaza [ACTIVITY_ID] con el ID del paso 8
   - Cuerpo (JSON):
     {
       "respuestas": "Quiero aprender Python"
     }
   - Respuesta esperada: 200 OK con confirmación

NOTAS IMPORTANTES:
- Las cookies de sesión se guardan automáticamente en Postman
- Asegúrate de que "Cookies" esté habilitado en Postman
- Los endpoints que requieren autenticación fallarán si no estás logueado
- Los endpoints admin/staff requieren rol específico (solo usuarios con esos roles pueden usarlos)
- Dominios de email permitidos: @usena.cl, @alumnouls.cl

VARIABLES GLOBALES (opcional):
Si quieres reutilizar IDs, edita:
- {{baseUrl}}: base URL de la API (default: http://localhost:3000)
- {{userId}}: ID del usuario actual
- {{registrationRequestId}}: ID de solicitud de registro
- {{activityId}}: ID de actividad

TROUBLESHOOTING:
1. "Cannot connect to localhost:3000"
   → Asegúrate de ejecutar `npm run dev` primero
   → Verifica que el puerto 3000 esté disponible

2. "CSRF token inválido"
   → Esto ocurre si usas Postman con JSON directo
   → Los formularios HTML incluyen el token automáticamente
   → Para API JSON, la validación de CSRF puede ser omitida en desarrollo

3. "Session not initialized"
   → Asegúrate de que las cookies estén habilitadas en Postman
   → Ve a Settings → Cookies y verifica que esté activo

4. "Email service not configured"
   → Normal en desarrollo
   → Las notificaciones de email no se enviarán hasta configurar SMTP

Última actualización: 2024-11-17
